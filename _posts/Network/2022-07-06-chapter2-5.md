---
title:  "네트워크 원리 chapter 2 - 5"
excerpt: "데이터를 송 수신한다"
toc: true
toc_sticky: true

categories:
  - 네트워크 원리
tags:
  - [Network]
---  

# 5. IP와 이더넷의 패킷 송수신 동작 #
TCP 담당 부분에서 필요한 헤더 및 데이터를 추가한 이후에 IP 담당 부분에게 의뢰한다.

## 1. 패킷의 기본 ##
- 패킷은 헤더 + 데이터로 나뉜다. (주소 등의 제어 정보 + 안의 내용물)

![패킷의 구조](https://user-images.githubusercontent.com/63405904/138543891-a6fa10df-b371-4f35-97a5-7c2001b22910.png){: #magnific title="https://yjksw.github.io/one-percent-network-4/"}

- 패킷의 흐름은 패킷의 헤더에 적힌 제어정보와 중계 장치에 있는 표의 정보를 결합하여 다음 패킷 목적지로 이동하며 최종 목적지에 도착한다.
  - 송신처와 최송 수신처를 ‘엔드 노드’라고 부른다.

### TCP/IP 에서 패킷 구조 ###
두 가지 중계 장치가 있다. 서브넷을 관리하는 ‘허브’와 IP를 담당하는 ‘라우터’이다.

각각 다음 역할을 한다.

- 라우터가 목적지를 확인하여 다음 라우터를 찾는다.
  - IP가 다음 목적지를 확인하여 다음 IP 중계 장치를 찾는다.
- 허브가 서브넷 안에서 패킷을 운반해 다음 라우터에 도착하도록 한다.
  - 서브넷 안의 이더넷이 라우터까지 패킷을 운반한다.

위 역할을 수행하기 위해서 패킷에 다음 두 헤더가 붙어 있다.

1. MAC 헤더 (이더넷용 헤더)
2. IP 헤더 (IP용 헤더)

- 패킷 운반 흐름은 다음과 같다.
  - 먼저 클라이언트가 TCP 헤더 + 데이터를 이어붙이고 목적 IP 주소에 맞는 다음 라우터를 조사한다.
  - 다음 라우터가 정해지면 해당 라우터에 대한 MAC 주소를 조사하고 패킷의 MAC 헤더에 추가한다.
  - 이더넷에게 해당 라우터로 패킷을 전송하도록 의뢰하여 패킷을 송신한다.
  - 이더넷에 의해 허브에 도착한다. 허브에서 이더넷 표와 헤더 정보를 결합해서 다음 라우터로 중계한다.
    - 만일 허브가 여러개라면 여러 허브를 순차적으로 경우한다.
  - 다음 라우터에 도착해서 IP용 표를 통해 다음 라우터를 조사하여 MAC 주소를 헤더가 기록한다.
    - 동일하게 허브를 경유하여 다음 라우터에 도착한다. 수신처에 도착할 때까지 반복한다.

![패킷의 운반 원리](https://user-images.githubusercontent.com/63405904/138543896-57e300fe-ae57-4d72-9638-387b2acdd4cd.png){: #magnific title="https://yjksw.github.io/one-percent-network-4/"}

- 이더넷 대신 무선 LAN, ADSL 등으로 대체될 수 있다.
  - IP의 의뢰를 받아서 패킷을 운반할 수 있는 것이면 된다.

## 2. 패킷 송수신 동작의 개요 ##

IP 담당은 패킷을 송출하고 실제 패킷의 운반은 네트워크 기기인 허브 및 라우터가 수행한다.

- TCP 담당에서 TCP 헤더와 데이터가 붙은 채로 IP 담당에게 넘어온다.
- IP 담당은 넘어온 패킷을 들여다보지 않고 단지 헤더를 추가한다.
  - IP 헤더와 MAC 헤더를 추가한다.
- IP 헤더: 목적지를 나타내는 제어정보
- MAC 헤더: LAN을 사용해서 가까운 라우터까지 패킷을 운반할 때 사용할 제어정보
- 완성된 패킷을 네트워크 하드웨어 LAN 어댑터에 보낸다.
  - 0과 1로 이루어진 디지털 데이터의 모습이다.
  - LAN 어댑터는 전기나 빛의 신호로 바꾸어 케이블로 송출한다.
  - 이후 허브나 라우터 등의 중계 장치에 도착한다.
- IP 담당에서 바라보는 패킷은 그 역할이 구분되어 있지 않고 단순히 ‘패킷’이라는 덩어리일 뿐이다. 패킷의 내용, 순서, 유무도 상관하지 않는다.
 

## 3. 수신처 IP주소를 기록한 IP 헤더를 만든다 ##

## 4. 이더넷용 MAC 헤더를 만든다 ##

## 5. ARP로 수신처 라우터의 MAC 주소를 조사한다 ##

## 6. 이더넷의 기본 ##

## 7. IP 패킷을 전기나 빛의 신호로 변환하여 송신한다 ##
 
## 8. 패킷에 3개 제어용 데이터를 추가한다 ##

## 9. 허브를 향해 패킷을 송신한다 ##

## 10. 돌아온 패킷을 받는다 ##

## 11. 서버의 응답 패킷을 IP 에서 TCP로 넘긴다 ##